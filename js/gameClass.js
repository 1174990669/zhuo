;(function(e,t,n,r){var i={panel:"#J-panel-gameTypes"},s,o=e.Games,u={init:function(e){var t=this;o.setCurrentGameTypes(t),t.container=$(e.panel),t.data=o.getCurrentGame().getGameConfig().getInstance().getMethods(),t.buildDom(),t.initEvent()},buildDom:function(){var e=this,t,n,r,i=[],s=[],o=[];$.each(e.data,function(){i=[],t=this,i.push('<li class="gametypes-menu-'+t.name_en+'">'),i.push('<div class="title">'),i.push(t.name_cn),o[0]=t.name_en,i.push("<span></span>"),i.push("</div>"),i.push("</li>"),s.push(i.join(""))}),e.getContainerDom().html(s.join("")),e.buildPanelMenu(),setTimeout(function(){e.fireEvent("endShow")},20)},buildPanelMenu:function(){var e=this,t,n,r,i=[],s=[],o=[],u=e.getPanelDom();$.each(e.data,function(){i=[],t=this,i.push('<li class="gametypes-sort gametypes-menu-'+t.name_en+'">'),i.push('<div class="content clearfix">'),$.each(t.children,function(){n=this,o[1]=n.name_en,i.push("<dl>"),i.push('<dt class="types-node types-node-'+n.name_en+'">'+n.name_cn+"</dt>"),$.each(n.children,function(){r=this,o[2]=r.name_en,i.push('<dd class="types-item" data-id="'+r.id+'">'+r.name_cn+"</dd>")}),i.push("</dl>")}),i.push("</div>"),i.push("</li>"),s.push(i.join(""))}),u.html(s.join(""))},initEvent:function(){var e=this;e.getPanelDom().on("click",".types-item",function(){var t=$(this),n=t.attr("data-id");n&&e.changeMode(n,t)}),e.container.on("click",".title",function(){var t=$(this).parent().index(),n=$(this).parents("ul").find("li"),r=e.getPanelDom().find(".gametypes-sort");n.removeClass("current").eq(t).addClass("current"),r.hide().removeClass("current").eq(t).addClass("current").show();var i=r.eq(t).find("dd.types-item:first").attr("data-id");e.changeMode(i)})},getContainerDom:function(){return this.container},getPanelDom:function(){return this.panelDom||(this.panelDom=$("#J-gametyes-menu-panel"))},changeMode:function(e,t){var n=this,r=n.getContainerDom();n.fireEvent("beforeChange",e);try{if(e==o.getCurrentGame().getCurrentGameMethod().getGameMethodName())return}catch(i){}o.getCurrentGame().switchGameMethod(e)}},a=e.Class(u,n);a.defConfig=i,a.getInstance=function(e){return s||(s=new a(e))},e[t]=a})(caipiaogame,"GameTypes",caipiaogame.Event);(function(e,t,n,r){var s={containerEvent:"#J-panel-order-list-cont",containerDom:"#J-balls-order-container",totalLotterysNumDom:"#J-gameOrder-lotterys-num",totalBounsLists:"#J-bouns-lists-value",totalAmountDom:"#J-gameOrder-amount",totalRebateDom:"#J-rebate-amount",selectedClass:"game-order-current",rowTemplate:'<li data-param="action=reselect&id=<#=id#>&mid=<#=mid#>" id="gameorder-<#=id#>">	<span data-param="action=reselect&id=<#=id#>" class="name" title="<#=typeText#>"><#=typeText#></span>	<span data-param="action=reselect&id=<#=id#>" class="number" title="<#=lotterysText#>"><#=lotterysText#></span>	<span data-param="action=reselect&id=<#=id#>" class="unit"><#=moneyUnitText#></span>	<span data-param="action=reselect&id=<#=id#>" class="bet"><#=num#>注</span>	<span data-param="action=reselect&id=<#=id#>" class="multiple"><#=multiple#>倍</span>	<span data-param="action=reselect&id=<#=id#>" class="price"><span>&yen;</span><#=amountText#></span>	<span data-param="action=reselect&id=<#=id#>" class="prizeGroup" prizeGroup="<#=prizeGroup#>" >返<#=prizeGroupVal#>元</span>	<a data-param="action=del&id=<#=id#>" href="javascript:void(0);" title="删除" class="delete"></a> </li>',lotterysTextLength:40,addOrderDom:"#J-add-order"},o=e.Games,u,a=1,f=Object.prototype.toString,l=function(e){var t=$.trim(e).split("&"),n=0,r=t.length,i,s={};for(;n<r;n++)i=t[n].split("="),i.length>0&&(i.length==2?s[i[0]]=i[1]:s[i[0]]="");return s},c={init:function(e){var t=this,e=t.defConfig;t.cacheData={},t.cacheData.detailPostParameter={},t.orderData=[],t.fastOrderData=[],o.setCurrentGameOrder(t),t.container=$(e.containerDom),t.containerEvent=$(e.containerEvent),t.totalLotterysNum=0,t.totalLotterysNumDom=$(e.totalLotterysNumDom),t.totalAmount=0,t.totalAmountDom=$(e.totalAmountDom),t.totalRebateDom=$(e.totalRebateDom),t.currentSelectId=0,t.eventProxy(),t.addEvent("afterAdd",function(){var e=o.getCurrentGameTrace().getRowTableType();o.getCurrentGameTrace().getIsTrace()==1&&o.getCurrentGameTrace().autoDeleteTrace()}),t.addEvent("afterRemoveData",function(){var e=o.getCurrentGameTrace().getRowTableType();o.getCurrentGameTrace().getIsTrace()==1&&o.getCurrentGameTrace().autoDeleteTrace()}),t.addEvent("afterResetData",function(){var e=o.getCurrentGameTrace().getRowTableType();o.getCurrentGameTrace().getIsTrace()==1&&o.getCurrentGameTrace().autoDeleteTrace()}),o.getCurrentGameTypes().addEvent("endChange",function(){t.cancelSelectOrder()})},setTotalLotterysNum:function(e){var t=this,n=t.totalLotterysNum;t.totalLotterysNum=Number(e),t.totalLotterysNumDom.html(e),n!=t.totalLotterysNum&&t.fireEvent("afterChangeLotterysNum",t.totalLotterysNum)},setTotalAmount:function(e){var t=this,n=t.totalAmount;t.totalAmount=Number(e),t.totalAmountDom.html(t.formatMoney(e)),n!=t.totalAmount&&t.fireEvent("afterChangeAmout",t.totalAmount)},setTotalRebate:function(t){var n=this,r=n.totalRebate,t=t||0,i=Math.pow(10,6);t=""+parseFloat(t*i/i),t=t.split(".");if(t[1]){var s=""+t[1];s.length>6&&(s=s.slice(0,6)),str=e.util.formatMoney(t[0],0)+"."+s}else str=e.util.formatMoney(t[0],2);n.totalRebate=Number(str),n.totalRebateDom.html(str),r!=n.totalRebate&&n.fireEvent("afterChangeRebate",n.totalRebate)},addData:function(e){var t=this;t.orderData.unshift(e)},getOrderById:function(e){var t=this,e=Number(e),n=t.orderData,r=0,i=n.length;for(r=0;r<i;r++)if(Number(n[r]["id"])==e)return n[r]},removeData:function(e){var t=this,e=Number(e),n=t.orderData,r=0,i=n.length;for(;r<i;r++)if(n[r]["id"]==e){t.fireEvent("beforeRemoveData",n[r]),t.orderData.splice(r,1),t.updateData(),t.fireEvent("afterRemoveData");break}$("#gameorder-"+e).remove(),t.fireEvent("afterRemoveData")},reSet:function(){var e=this;return e.container.empty(),e.orderData=[],e.updateData(),e.fireEvent("afterResetData"),e},updateData:function(){var e=this,t=e.getTotal();e.setTotalLotterysNum(t.count),e.setTotalAmount(t.amount),e.setTotalRebate(t.rebate)},getTotal:function(){var e=this,t=e.orderData,n=0,r=t.length,i=0,s=0,o=0;for(;n<r;n++)i+=t[n].num,s+=t[n].num*t[n].onePrice*t[n].moneyUnit*t[n].multiple,o+=Number(t[n].prizeGroupVal);return{count:i,amount:s,rebate:o,orders:t}},getOrderMaxMultiple:function(){var e=this,t,n,r=e.getTotal().orders,i=0,s,u=r.length,a,f,l=[],c="",h;for(;i<u;i++){a=r[i].mid,f=r[i].multiple,t=o.getCurrentGame().getGameConfig().getInstance().getPrizeById(a),s=o.getCurrentGame().getGameConfig().getInstance().getMethodFullNameById(a);if(!t||!t.max_multiple){c=o.getCurrentGame().getGameConfig().getInstance().getMethodCnFullNameById(a).join(""),alert("["+c+"]\n玩法未配置奖金组中奖金额，投注倍数未能得到限制\n请配置该玩法相关配置");return}n=t.max_multiple,h=Number(n)<0?99999999:Number(n),l.push({gameMethod:s,maxnum:Math.floor(h/f)})}return l.sort(function(e,t){return e.maxnum-t.maxnum}),l.length>0?l[0]:{gameMethod:"",maxnum:1e8}},add:function(e){var t=this,n="",r=-1,i=t.defConfig.rowTemplate,s=0,u=0,f=o.getCurrentGameTrace().getIsTrace(),l,c,h;t.fireEvent("beforeAdd",e),e.lotterys?e.lotterys.constructor===Array?c=e.lotterys.length:c=Number(e.lotterys):c=0;if(!(c>0))return!1;if(t.currentSelectId>0)e.id=t.currentSelectId;else{r=t.checkData(e);if(r!=-1){o.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){t.addMultiple(e.multiple,e.prizeGroupVal,r),this.hide()},data:{tplData:{msg:"您选择的号码在号码篮已存在，将直接进行倍数累加"}}});return}e.id=a++}e.amountText=t.formatMoney(e.num*e.moneyUnit*e.multiple*e.onePrice);if(!!f&&(o.getCurrentGameTrace().getRowTableType()=="yingli"||o.getCurrentGameTrace().getRowTableType()=="yinglilv"))for(u=0,h=t.orderData.length;u<h;u++)if(t.orderData[u]["type"]!=e["type"]||t.orderData[u]["moneyUnit"]!=e["moneyUnit"]){alert("盈利追号和盈利率追号不允许混投，\n 请确保玩法类型和元角模式一致");return}e.postParameter=o.getCurrentGame().getCurrentGameMethod().makePostParameter(e.original,e),e.oldMultiple=e.multiple,n=t.formatRow(i,t.rebuildData(e)),t.currentSelectId>0?t.replaceOrder(e.id,e):t.addData(e),t.currentSelectId>0?($(n).replaceAll($("#gameorder-"+t.currentSelectId)),t.cancelSelectOrder()):$(n).prependTo(t.container),o.getCurrentGame().getCurrentGameMethod().reSet(),o.getCurrentGameStatistics().reSet(),t.updateData(),t.fireEvent("afterAdd",e)},fastAdd:function(e){var t=this;t.fastOrderData=[],e.id=a++,e.amountText=t.formatMoney(e.num*e.moneyUnit*e.multiple*e.onePrice),e.postParameter=o.getCurrentGame().getCurrentGameMethod().makePostParameter(e.original,e),t.fastOrderData.push(e),o.getCurrentGame().getCurrentGameMethod().reSet(),o.getCurrentGameStatistics().reSet()},replaceOrder:function(e,t){var n=this,r=n.orderData,i=0,s=r.length;for(;i<s;i++)if(r[i]["id"]==e){r[i]=t;return}},render:function(){var e=this,t=e.getTotal().orders,n=0,r=t.length,i=[],s=e.defConfig.rowTemplate;for(;n<r;n++)i[n]=e.formatRow(s,e.rebuildData(t[n]));e.updateData(),e.container.html(i.join(""))},rebuildData:function(e){var t=this,n=t.defConfig,r=o.getCurrentGame().getGameConfig().getInstance(),i=r.getMethodCnFullNameById(e.mid);return typeText=r.getMethodCnFullNameById(e.mid).join(","),method=o.getCurrentGame().getCacheMethod(e.mid),i[0]==i[1]&&i[1]==i[2]&&(typeText=r.getMethodCnFullNameById(e.mid)[2]),e.typeText=typeText,e.lotterysText=method.formatViewBalls(e.original).substr(0,300),e.viewBalls=e.lotterysText,e.moneyUnitText=e.moneyUnitText||o.getCurrentGameStatistics().getMoneyUnitDom().getText(),e},formatRow:function(e,t){var n=this,r=t,i,s,o=["万","千","百","十","个"];if(r.extra.position){var u=[];for(var a=0;a<r.extra.position.length;a++)u.push("<i>"+o[r.extra.position[a]]+"</i>");r.lotterysText=u.join("")+""+r.lotterysText}for(i in r)r.hasOwnProperty(i)&&(s=RegExp("<#="+i+"#>","g"),e=e.replace(s,r[i]));return e},originalData:function(e){var t=this,n=[];for(var r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)n[i]=n[i]||[],t.arrIndexOf(e[r][i],n[i])||n[i].push(e[r][i]);return n},arrIndexOf:function(e,t){var n;for(var r=0;r<t.length;r++)t[r]==e&&(n=!0);return n||!1},checkData:function(e){var t,n,r,i,s,o=this,u=[],a=0,f,l;r=e.type,t=e.original,i=e.prizeGroup,s=e.extra.position;for(var a=0;a<t.length;a++)u.push(t[a].join(""));return moneyUnit=e.moneyUnit,o.searchSameResult(r,u.join(),moneyUnit,i,s)},eventProxy:function(){var e=this,t=e.containerEvent;t.on("click",function(t){var n=t.target.getAttribute("data-param"),r;n&&$.trim(n)!=""&&(r=l(n),$.isFunction(e["exeEvent_"+r.action])&&e["exeEvent_"+r.action].call(e,r,t.target))})},exeEvent_del:function(e){var t=this,n=Number(e.id);t.currentSelectId==n&&(o.getCurrentGame().getCurrentGameMethod().reSet(),t.cancelSelectOrder()),t.removeData(n)},exeEvent_detailhide:function(e,t){$(t).parents(".lottery-details-area").eq(0).hide()},exeEvent_detail:function(e,t){var n=this,t=$(t),r=Number(e.id),i=r,s=t.next(),o=s.find(".multiple"),u=s.find(".list"),a=n.getTotal().orders,f="";n.cacheData.currentDetailId&&$("#gameorder-"+n.cacheData.currentDetailId+" .lottery-details-area").hide();if(n.cacheData.detailPostParameter[i])f=n.cacheData.detailPostParameter[i],n.cacheData.currentDetailId=i;else{for(var l=a.length-1;l>=0;l--)if(a[l]["id"]==r){a=a[l];break}o.text("共 "+a.num+" 注"),f=a.postParameter,n.cacheData.currentDetailId=i,n.cacheData.detailPostParameter[i]=f,s.css({left:s.position().left+s.width()+5})}u.html(f),s.show()},exeEvent_reselect:function(e){var t=this,n=Number(e.id);t.selectOrderById(n)},updateDomStatus:function(){var e=this,t="button-game-edit",n=e.currentSelectId,r=$(e.defConfig.addOrderDom);n>0?r.addClass(t):r.removeClass(t)},selectOrderById:function(e){var t=this,n=t.getOrderById(e),r=n.original,i=n.type,s=t.defConfig.selectedClass,u=$("#gameorder-"+e);if(t.getOrderById(e)["type"].indexOf("danshi")!=-1)return;u.parent().children().removeClass(s),u.addClass(s),o.getCurrentGameTypes().changeMode(n.mid),o.getCurrentGameStatistics().getMultipleDom().setValue(n.multiple),o.getCurrentGameStatistics().triggerMoneyUnit(n.moneyUnit),o.getCurrentGameStatistics().setSliderValueByPrizeGroup(n.prizeGroup),o.getCurrentGame().getCurrentGameMethod().reSelect(r),t.currentSelectId=e,t.updateDomStatus()},cancelSelectOrder:function(){var e=this,t=e.currentSelectId,n=$(e.defConfig.addOrderDom);t>0&&($("#gameorder-"+t).removeClass(e.defConfig.selectedClass),e.currentSelectId=0,e.updateDomStatus(),o.getCurrentGame().getCurrentGameMethod().reSet())},formatMoney:function(e){var e=Number(e),t=/(-?\d+)(\d{3})/;Number.prototype.toFixed?e=e.toFixed(3):e=Math.round(e*100)/100,e=""+e;while(t.test(e))e=e.replace(t,"$1,$2");return e},searchSameResult:function(e,t,n,r,i){var s=this,o,u,a=0,f=[],l=s.getTotal().orders;for(;a<l.length;a++){f=[],o=l[a],ordersLotteryText=o.original;for(var c=0;c<ordersLotteryText.length;c++)f.push(ordersLotteryText[c].join(""));if(o.type==e&&t==f.join()&&o.moneyUnit==n&&r==o.prizeGroup&&i==o.extra.position)return a}return-1},addMultiple:function(e,t,n){var r=this,i=r.getTotal().orders,s=i[n],u=s.type,a=s.mid,f=999999;if(o.getCurrentGameTrace().getIsTrace()==1)return;f=o.getCurrentGame().getGameConfig().getInstance().getLimitByMethodId(a,s.moneyUnit),f=f<0?s.multiple+e:f;if(s.multiple+e>f){setTimeout(function(){o.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){i[n].multiple=f,i[n].oldMultiple=i[n].multiple,i[n].amount=i[n].num*i[n].moneyUnit*i[n].multiple*i[n].onePrice,i[n].amountText=r.formatMoney(i[n].num*i[n].moneyUnit*i[n].multiple*i[n].onePrice),i[n].prizeGroupVal=Number(i[n].prizeGroupVal),r.render(),o.getCurrentGame().getCurrentGameMethod().reSet(),o.getCurrentGame().getCurrentGameMethod().ballsErrorTip(),o.getCurrentGameStatistics().reSet(),this.hide()},data:{tplData:{msg:"该组号码倍数已经超过最大限制("+f+"倍)，将调整为系统支持的最大倍数进行添加"}}})},100);return}i[n].multiple+=e,i[n].oldMultiple=i[n].multiple,i[n].amount=i[n].num*i[n].moneyUnit*i[n].multiple*i[n].onePrice,i[n].amountText=r.formatMoney(i[n].num*i[n].moneyUnit*i[n].multiple*i[n].onePrice),i[n].prizeGroupVal=Number(i[n].prizeGroupVal)+Number(t),r.render(),o.getCurrentGame().getCurrentGameMethod().reSet(),o.getCurrentGame().getCurrentGameMethod().ballsErrorTip(),o.getCurrentGameStatistics().reSet(),r.cancelSelectOrder()},editMultiples:function(e){var t=this,n=t.getTotal().orders,r=0,i=n.length;for(;r<i;r++)n[r].multiple=e,n[r].amount=n[r].num*n[r].moneyUnit*n[r].multiple*n[r].onePrice,n[r].amountText=t.formatMoney(n[r].amount);t.render(),t.cancelSelectOrder()},editMultiple:function(e,t){var n=this,r=n.getTotal().orders;r[t].multiple=e,r[t].amount=r[t].num*r[t].moneyUnit*r[t].multiple*r[t].onePrice,r[t].amountText=n.formatMoney(r[i].amount),n.render(),n.cancelSelectOrder()},restoreMultiples:function(){var e=this,t=e.getTotal().orders,n=0,r=t.length;for(;n<r;n++)t[n].multiple=t[n].oldMultiple,t[n].amount=t[n].num*t[n].moneyUnit*t[n].multiple*t[n].onePrice,t[n].amountText=e.formatMoney(t[n].amount);e.render(),e.cancelSelectOrder()}},h=e.Class(c,n);h.defConfig=s,h.getInstance=function(e){return u||(u=new h(e))},e[t]=h})(caipiaogame,"GameOrder",caipiaogame.Event);(function(e,t,n,r){var s={mainPanel:"#J-trace-panel",advancedTypeHas:["fanbei","yingli","yinglilv"],defaultType:"normal",dataRowHeader:'<tr><th style="width:125px;" class="text-center">序号</th><th><input data-action="checkedAll" type="checkbox"  checked="checked"/> 追号期次</th><th>倍数</th><th>金额</th><th>预计开奖时间</th></tr>',dataRowTemplate:'<tr><td class="text-center"><#=No#></td><td><input data-action="checkedRow" class="trace-row-checked" type="checkbox" checked="checked"> <span class="trace-row-number" issueCode=<#=issueCode#>><#=traceNumber#></span></td><td><input class="trace-row-multiple" value="<#=multiple#>" type="text" style="width:50px;text-align:center;"> 倍</td><td><span class="price"><dfn>&yen;</dfn><span class="trace-row-money"><#=money#></span> 元</span> </td><td><span class="trace-row-time"><#=publishTime#></span></td></tr>',dataRowYingliHeader:'<tr><th class="text-center">序号</th><th><input data-action="checkedAll" type="checkbox" /> 追号期次</th><th>倍数</th><th>金额</th><th>奖金</th><th>预期盈利金额</th><th>预期盈利率</th></tr>',dataRowYingliTemplate:'<tr><td class="text-center"><#=No#></td><td><input data-action="checkedRow" class="trace-row-checked" type="checkbox" checked="checked"> <span class="trace-row-number" issueCode=<#=issueCode#>><#=traceNumber#></span></td><td><input class="trace-row-multiple" value="<#=multiple#>" type="text" style="width:50px;text-align:center;"> 倍</td><td><span class="price"><dfn>&yen;</dfn><span class="trace-row-money"><#=money#></span> 元</span></td><td><span class="price"><dfn>&yen;</dfn> <span class="trace-row-userGroupMoney"><#=userGroupMoney#></span> </span>元</td><td><span class="price"><dfn>&yen;</dfn> <span class="trace-row-winTotalAmount"><#=winTotalAmout#></span> 元</span></td><td><span class="trace-row-yinglilv"><#=yinglilv#></span>%</td></tr>'},o,u=e.Games,a=function(e,t,n){var e=""+e,n=n||1e9;return e=e.replace(/[^\d]/g,""),e=e==""?t:Number(e)>n?n:e,Number(e)},f=function(e){return e=e.replace(/[^\d]/g,""),Number(e)},l={init:function(e){var t=this;t.opts=e,u.setCurrentGameTrace(t),t.panel=$(e.mainPanel),t.panelIsVisible=!1,t.TraceTab=null,t.TraceAdvancedTab=null,t.orderData=null,t.isOpenPanel=!1,t.orderData=null,t.traceType=e.defaultType,t.times=0,t.traceStartNumber="",t.currentTraceNumber="",t.isTrace=0,t.savedTraceData=null,t.advancedType=e.advancedTypeHas[0],t.typeTypeType="a",t.initEvent(),t.setCurrentTraceNumber(),u.getCurrentGame().addEvent("changeDynamicConfig",function(){t.buildStartNumberSelectDom(),t.updateTableNumber()})},getIsTrace:function(){return this.isTrace},setIsTrace:function(e){this.isTrace=Number(e),e<1?$("#J-button-trace-confirm").addClass("disable"):$("#J-button-trace-confirm").removeClass("disable")},setAdvancedType:function(e){Object.prototype.toString.call(e)=="[object Number]"?this.advancedType=this.getAdvancedTypeBuIndex(e):this.advancedType=e},getAdvancedType:function(){return this.advancedType},getAdvancedTypeBuIndex:function(e){var t=this,n=t.defConfig.advancedTypeHas,r=n.length;return e<r?n[e]:""},getMaxMultiple:function(){var e=u.getCurrentGameOrder().getOrderMaxMultiple(),t=e.maxnum*1/Number(u.getCurrentGameOrder().orderData[0].moneyUnit);if(u.getCurrentGameOrder().orderData.length>0){var n=u.getCurrentGameOrder().orderData;$.each(n,function(n){var r=e.maxnum*1/Number(u.getCurrentGameOrder().orderData[n].moneyUnit);t=r>t?t:r})}return t},initEvent:function(){var t=this,n=$("#userName"),r=this.traceTips=new caipiaogame.Tip({cls:"j-ui-tip-close j-ui-tip-yellow j-ui-tip-t",text:'<h4><i class="close">ⅹ</i>温馨提示</h4><p>平台功能小调整，默认勾选中奖后停止追号</p>'});$(".j-ui-tip-close .close").click(function(){var e=new Date;e.setFullYear(e.getFullYear()+1),jQuery.cookie(n+"data",1,{expires:e}),r.hide()}),$("#J-trace-switch").click(function(){if(this.checked){var e=u.getCurrentGameOrder().getTotal().amount,t=u.getCurrentGameMessage();if(e<=0){t.show({type:"mustChoose",msg:"请至少选择一注投注号码！",data:{tplData:{msg:"请至少选择一注投注号码！"}}}),$("#J-trace-switch").get(0).checked=!1;return}u.getCurrentGameTrace().show(),$("#J-trace-iswintimesstop").get(0).checked=!0;var i=$("#J-trace-iswintimesstop-panel");jQuery.cookie(n+"data")||r.show(-100,40,i)}else u.getCurrentGameTrace().hide(),r.hide()}),t.TraceTab=TraceTab=new e.Tab({par:"#J-trace-panel",triggers:".chase-tab-t",panels:".chase-tab-content",currPanelClass:"chase-tab-content-current",eventType:"click"}),TraceTab.addEvent("afterSwitch",function(e,n){var r=["normal","advanced"];n<r.length&&t.setTraceType(r[n]),t.updateStatistics()}),t.TraceAdvancedTab=TraceAdvancedTab=new e.Tab({par:"#J-trace-advanced-type-panel",triggers:".tab-title li",panels:".tab-content li",eventType:"click"}),TraceAdvancedTab.addEvent("afterSwitch",function(e,n){var r=this.getPanel(n).find(".trace-advanced-type-switch");t.setAdvancedType(n),r.each(function(){if(this.checked)return t.setTypeTypeType($(this).parent().attr("data-type")),!1})});var i=new e.Hover({triggers:"#J-trace-iswintimesstop-hover",panels:"#chase-stop-tip-1",currPanelClass:"chase-stop-tip-current",hoverDelayOut:300});$("#chase-stop-tip-1").mouseleave(function(){i.hide()});var s=new e.Hover({triggers:"#J-trace-iswinstop-hover",panels:"#chase-stop-tip-2",currPanelClass:"chase-stop-tip-current",hoverDelayOut:300});$("#chase-stop-tip-2").mouseleave(function(){s.hide()}),$("#J-chase-stop-switch-1").click(function(e){e.preventDefault(),$("#J-trace-iswintimesstop-panel").hide(),$("#J-trace-iswinstop-panel").show(),$("#J-trace-iswintimesstop").get(0).checked=!1,$("#J-trace-iswinstop").get(0).checked=!0,$("#J-trace-iswinstop-money").removeAttr("disabled"),$("#J-trace-iswintimesstop-times").attr("disabled","disabled")}),$("#J-chase-stop-switch-2").click(function(e){e.preventDefault(),$("#J-trace-iswinstop-panel").hide(),$("#J-trace-iswintimesstop-panel").show(),$("#J-trace-iswintimesstop").get(0).checked=!0,$("#J-trace-iswinstop").get(0).checked=!1,$("#J-trace-iswinstop-money").attr("disabled","disabled"),$("#J-trace-iswintimesstop-times").removeAttr("disabled")}),$("#J-trace-iswinstop-money").keyup(function(){this.value=a(this.value,1,999999)}),$("#J-trace-iswintimesstop-times").keyup(function(){this.value=a(this.value,1,999999)}),$("#J-trace-iswintimesstop").click(function(){var e=$("#J-trace-iswintimesstop-times");this.checked?e.attr("disabled",!1).focus():e.attr("disabled","disabled")}),$("#J-trace-iswinstop").click(function(){var e=$("#J-trace-iswinstop-money");this.checked?e.attr("disabled",!1).focus():e.attr("disabled","disabled")}),$("#J-trace-normal-times").keyup(function(){var e=u.getCurrentGame().getGameConfig().getInstance().getTraceMaxTimes(),n=""+this.value,r,i=$("#J-function-select-tab").find(".function-select-title li"),s="current";n=n.replace(/[^\d]/g,""),n=n==""?1:Number(n)>e?e:n,this.value=n,r=Number(n),r>0&&r<=20&&r%5==0?(J-button-trace-confirm,i.removeClass(s).eq(r/5-1).addClass(s),o.index=r/5-1):(i.removeClass(s),o.index=22),t.buildDetail(),t.applyTraceData()});var o=new e.Tab({par:"#J-function-select-tab",triggers:".function-select-title li",panels:".function-select-panel li",eventType:"click",index:1});o.addEvent("afterSwitch",function(e,n){var r=this,i=parseInt(r.getTrigger(n).text());$("#J-trace-normal-times").val(i),t.buildDetail(),t.applyTraceData()}),t.normalSelectMultiple=new e.Select({realDom:"#J-trace-normal-multiple",isInput:!0,expands:{inputEvent:function(){var e=this;e.getInput().keyup(function(t){var n=this.value,r=99999;this.value=this.value.replace(/[^\d]/g,""),n=Number(this.value),n<1&&(this.value=1),n>r&&(this.value=r),e.setValue(this.value)})}}}),t.normalSelectMultiple.addEvent("change",function(e,n,r){var i=t.getOrderData().amount,s=Number(n),o=u.getCurrentGameOrder().getOrderMaxMultiple(),a=o.maxnum,f=u.getCurrentGameMessage(),l="";s>a?(l=u.getCurrentGame().getGameConfig().getInstance().getTitleByName(o.gameMethod).join("-"),f.show({confirmIsShow:!0,mask:!0,msg:"",tpl:'<div class="pop-waring"><i class="ico-waring &lt;#=icon-class#&gt;"></i><h4 class="pop-text"><#=msg#></h4></div>',data:{tplData:{msg:"您输入的倍数超过了<b>["+l+"]</b> 玩法的最高倍数限制，系统将自动修改为最大可输入倍数"}},confirmFun:function(){n=a,t.normalSelectMultiple.setValue(n),f.hide(),t.getTable().find(".trace-row-multiple").val(n),t.getTable().find(".trace-row-money").each(function(){var e=$(this),r=Number(e.parent().parent().find(".trace-row-multiple").val());e.html(t.formatMoney(i*Number(n)))}),t.updateStatistics()}})):(t.getTable().find(".trace-row-multiple").val(n),t.getTable().find(".trace-row-money").each(function(){var e=$(this),r=Number(e.parent().parent().find(".trace-row-multiple").val());e.html(t.formatMoney(i*Number(n)))}),t.updateStatistics())}),t.panel.find(".chase-table").keyup(function(e){var n=$(e.target),r=t.getOrderData().amount;if(n.hasClass("trace-row-multiple")){var i=Number(n.val()),s=t.getRowTableType(),o=Number(u.getCurrentGameOrder().getOrderMaxMultiple().maxnum);i==0?(n.val(n.val().replace(/^0/g,"")),n.parent().parent().find(".trace-row-money").html("0.00")):i>o?(i=o,n.val(i),n.parent().parent().find(".trace-row-money").html(t.formatMoney(r*i))):(n.parent().parent().find(".trace-row-money").html(t.formatMoney(r*i)),(s=="trace_advanced_yingli_a"||s=="trace_advanced_yingli_b"||s=="trace_advanced_yinglilv_a"||s=="trace_advanced_yinglilv_b")&&t.rebuildYinglilvRows()),t.updateStatistics()}}).on("blur",".trace-row-multiple",function(e){var n=$(e.target),r=Number(n.val()),i=t.getOrderData().amount;n.val(a(n.val(),1,u.getCurrentGameOrder().getOrderMaxMultiple().maxnum)),n.parent().parent().find(".trace-row-money").html(t.formatMoney(i*Number(n.val()))),t.updateStatistics()}),setTimeout(function(){var e=u.getCurrentGame().getGameConfig().getInstance().defConfig.gameType;$.trim(e)!="slmmc"&&t.buildStartNumberSelectDom()},10),$("#J-trace-advanced-times").keyup(function(){this.value=a(this.value,10,Number($("#J-trace-number-max").text()))}),$("#J-trace-advance-multiple").keyup(function(e){var t=$(e.target),n=Number(f(t.val())),r=Number(u.getCurrentGameOrder().getOrderMaxMultiple().maxnum);n==0?t.val(t.val().replace(/^0/g,"")):n>r?t.val(r):t.val(n)}).blur(function(){this.value=a(this.value,1,u.getCurrentGameOrder().getOrderMaxMultiple().maxnum)}),t.panel.find(".trace-advanced-type-switch").click(function(){var e=$(this),n=e.parent(),r=n.parent().children(),i;r.each(function(s){i=r.get(s),n.get(0)!=i?$(i).find('input[type="text"]').attr("disabled","disabled"):($(i).find('input[type="text"]').attr("disabled",!1).eq(0).focus(),t.setTypeTypeType(n.attr("data-type"))),e.parent().hasClass("trace-input-multiple")?this.value=a(this.value,1,u.getCurrentGameOrder().getOrderMaxMultiple().maxnum):this.value=a(this.value,1,99999)})}),$("#J-trace-advanced-type-panel").on("keyup","input[type=text]",function(e){var t=$(e.target);t.hasClass("trace-input-multiple")?this.value=a(this.value,1,u.getCurrentGameOrder().getOrderMaxMultiple().maxnum):this.value=a(this.value,1,99999)}),$("#J-trace-builddetail").click(function(){t.confirmSetting(),t.applyTraceData()}),t.panel.find(".chase-table").click(function(e){var n=$(e.target),r=$.trim(n.attr("data-action")),i=!0,s;if(!!r&&r!="")switch(r){case"checkedAll":i=n.get(0).checked?!0:!1,s=t.getRowTableType(),t.getTable().find(".trace-row-checked").each(function(){this.checked=i}),(s=="trace_advanced_yingli_a"||s=="trace_advanced_yingli_b"||s=="trace_advanced_yinglilv_a"||s=="trace_advanced_yinglilv_b")&&t.rebuildYinglilvRows(),t.updateStatistics();break;case"checkedRow":n.size()>0&&(s=t.getRowTableType(),(s=="trace_advanced_yingli_a"||s=="trace_advanced_yingli_b"||s=="trace_advanced_yinglilv_a"||s=="trace_advanced_yinglilv_b")&&t.rebuildYinglilvRows(),t.updateStatistics());break;default:}})},buildStartNumberSelectDom:function(){var t=this,n=u.getCurrentGame().getGameConfig().getInstance(),r=n.getGameNumbers()||0,i=r.length,s=0,o=[],a=n.getCurrentGameNumber(),f="(当前期)",l=f,c,h="";t.traceStartNumberSelect&&(c=t.traceStartNumberSelect.getValue());for(;s<i;s++)l=a==r[s]["number"]?f:"",h=!t.traceStartNumberSelect||r[s]["number"]!=c?"":' selected="selected" ',o.push('<option value="'+r[s].number+'" '+h+" >"+r[s].number+l+"</option>");$("#J-traceStartNumber").html(o.join("")),$("#J-trace-number-max").text(i),t.traceStartNumberSelect&&t.traceStartNumberSelect.dom.remove(),t.traceStartNumberSelect=new e.Select({realDom:"#J-traceStartNumber",cls:"chase-trace-startNumber-select"}),t.traceStartNumberSelect.addEvent("change",function(e,n,r){t.setTraceStartNumber(n)})},updateTableNumber:function(){var e=this,t=u.getCurrentGame().getGameConfig().getInstance().getGameNumbers(),n=t.length,r,i,s=u.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),o,a,f,l,c="",h,p="",d='<span class="icon-period-current"></span>',v,m=0,g=0,y,b=u.getCurrentGame().getGameConfig().getInstance().defConfig.gameType;n>0&&(r=e.getNormalRowTable().find("tr"),i=e.getAdvancedRowTable().find("tr"),h=e.getStartNumberIndexByNumber(o),r.each(function(e){if(e==0)return!0;a=$(this),f=a.find(".trace-row-number"),issuecodeNumber=a.find(".trace-row-number").attr("issuecode"),l=a.find(".trace-row-time"),multipleDom=a.find(".trace-row-multiple"),o=f.text().replace(/[^\d]/g,""),v=a.find(".text-center"),a.find(".trace-row-multiple").removeAttr("disabled");if(h+1<n){c=t[h+1]["number"]==s?d:"",f.html(t[h+1].number+c),multipleDom.val("1"),l.text(t[h+1].time),v.html("").html(e);if(p!=issuecodeNumber.substr(0,8)&&p!=""&&b!="fc3d"&&b!="p5"&&b!="ssq"){switch(m){case 0:y="明天 ";break;case 1:y="后天 ";break;case 2:y="大后天 ";break;default:y=""}m++,jQuery.trim(y)!=""&&v.html("").append('<div class="icon-chase-mark">'+y+" "+a.find(".trace-row-number").text().substr(0,8)+"</div>")}p=issuecodeNumber.substr(0,8),h++}}),h=e.getStartNumberIndexByNumber(o),i.each(function(e){if(e==0)return!0;a=$(this),f=a.find(".trace-row-number"),issuecodeNumber=a.find(".trace-row-number").attr("issuecode"),l=a.find(".trace-row-time"),multipleDom=a.find(".trace-row-multiple"),o=f.text().replace(/[^\d]/g,""),v=a.find(".text-center"),a.find(".trace-row-multiple").removeAttr("disabled");if(h+1<n){c=t[h+1]["number"]==s?d:"",f.html(t[h+1].number+c),multipleDom.val("1"),l.text(t[h+1].time),v.html("").html(e);if(p!=issuecodeNumber.substr(0,8)&&p!=""&&b!="fc3d"&&b!="p5"&&b!="ssq"){switch(g){case 0:y="明天 ";break;case 1:y="后天 ";break;case 2:y="大后天 ";break;default:y=""}g++,jQuery.trim(y)!=""&&v.html("").append('<div class="icon-chase-mark">'+y+" "+a.find(".trace-row-number").text().substr(0,8)+"</div>")}p=issuecodeNumber.substr(0,8),h++}}))},rebuildYinglilvRows:function(){var e=this,t=e.getRowTable().find("tr"),n=e.getOrderData(),r=e.getWinMoney(),i=null,s=null,o=null,u=1,a=null,f=0,l=null,c=null,h=null,p=-1;costAmount=0,t.each(function(t){t>0&&(i=$(this),s=i.find(".trace-row-checked"),s.size()>0&&s.get(0).checked&&(o=i.find(".trace-row-multiple"),u=Number(o.val()),a=i.find(".trace-row-money"),f=Number(a.text().replace(",","")),l=i.find(".trace-row-userGroupMoney"),c=i.find(".trace-row-winTotalAmount"),h=i.find(".trace-row-yinglilv"),costAmount+=n.amount*u,a.text(e.formatMoney(n.amount*u)),l.text(e.formatMoney(r*u)),c.text(e.formatMoney(r*u-costAmount)),p=(r*u-costAmount)/costAmount*100,h.text(Number(p).toFixed(2))))})},isOpen:function(){return this.isOpenPanel},setTypeTypeType:function(e){this.typeTypeType=e},getTypeTypeType:function(){return this.typeTypeType},getIsWinStop:function(){var e=this,t=$("#J-trace-iswintimesstop"),n=$("#J-trace-iswinstop");return t.get(0).checked?1:n.get(0).checked?2:0},getTraceWinStopValue:function(){var e=this,t=e.getIsWinStop();return t==1?Number($("#J-trace-iswintimesstop-times").val()):t==2?Number($("#J-trace-iswinstop-money").val()):-1},updateStatistics:function(){var e=this,t=e.getResultData();$("#J-trace-statistics-times").html(t.times),$("#J-trace-statistics-lotterys-num").html(t.lotterysNum),$("#J-trace-statistics-amount").html(e.formatMoney(t.amount))},getResultData:function(){var e=this,t=e.getOrderData(),n=e.getRowTable().find("tr"),r,i,s=0,o=0,a=0,f=[],l,c={times:0,lotterysNum:0,amount:0,orderData:t,traceData:[],traceType:e.getTraceType()},h="",p=u.getCurrentGame().getGameConfig().getInstance().getGameNumbers(),d,v,m=0,g,y=u.getCurrentGame().getGameConfig().getInstance().defConfig.gameType;return n.each(function(n){if(n==0)return;r=$(this),i=r.find(".trace-row-checked"),tracenumber=r.find(".trace-row-number").attr("issuecode"),traceNo=r.find(".text-center"),traceNo.html("").html(n);if(h!=tracenumber.substr(0,8)&&h!=""&&y!="fc3d"&&y!="p5"&&y!="ssq"){switch(m){case 0:g="明天 ";break;case 1:g="后天 ";break;case 2:g="大后天 ";break;default:g=""}jQuery.trim(g)!=""&&traceNo.html("").append('<div class="icon-chase-mark">'+g+" "+r.find(".trace-row-number").text().substr(0,8)+"</div>"),m++}h=tracenumber.substr(0,8),i.size()>0&&i.get(0).checked?(l=i.parent(),v=e.getStartNumberIndexByNumber(l.find(".trace-row-number").text()),v=v==-1?0:v,d=p[v].issueCode,r.find(".trace-row-multiple").removeAttr("disabled"),r.find(".trace-row-multiple").val()=="0"&&(r.find(".trace-row-multiple").val("1"),r.find(".trace-row-money").text(e.formatMoney(t.amount*1))),f.push({traceNumber:l.find(".trace-row-number").text(),issueCode:d,multiple:Number(l.parent().find(".trace-row-multiple").val())}),s++,a+=Number(r.find(".trace-row-money").text().replace(/,/g,""))):(r.find(".trace-row-money").text("0"),r.find(".trace-row-multiple").val("0"),r.find(".trace-row-multiple").attr("disabled","disabled").css("border-color","#CECECE"))}),!t||(o=s*t.count,c={times:s,lotterysNum:o,amount:a,orderData:t,traceData:f,traceType:e.getTraceType()}),c},updateOrder:function(e){var t=this,n=u.getCurrentGameOrder().getTotal(),r=t.getRowTableType(),i=u.getCurrentGameOrder().getOrderMaxMultiple(),s=i.maxnum,o=Number(t.normalSelectMultiple.getValue()),a=Number($("#J-trace-advance-multiple").val());t.setOrderData(n),o>s&&t.normalSelectMultiple.setValue(s),a>s&&$("#J-trace-advance-multiple").val(s),!e&&(r=="trace_advanced_fanbei_a"||r=="trace_advanced_fanbei_b"||r=="trace_advanced_yingli_a"||r=="trace_advanced_yingli_b"||r=="trace_advanced_yinglilv_a"||r=="trace_advanced_yinglilv_b")&&u.getCurrentGameMessage().show({type:"normal",closeFun:function(){this.hide()},data:{tplData:{msg:"您的方案已被修改，如果需要根据最新方案进行追号，请点击生成追号计划按钮"}}}),t.getAdvancedRowTable().html(""),t.updateDetail(n.amount),t.updateStatistics()},updateDetail:function(e){var t=this,n=t.getTable().find("tr"),r=null,i=null,s=null,o=null,u=null,a=0,f=t.getRowTableType(),l;if(f=="trace_advanced_yingli_a"||f=="trace_advanced_yingli_b"||f=="trace_advanced_yinglilv_a"||f=="trace_advanced_yinglilv_b")t.rebuildYinglilvRows();else{l=t.getAdvancedRowTable().attr("data-type");if(l=="trace_advanced_fanbei_a"||l=="trace_advanced_fanbei_b")n=t.getAdvancedTable().find("tr"),n.each(function(){r=$(this),rowMoney=r.find(".trace-row-money"),rowMultiple=Number(r.find(".trace-row-multiple").val()),rowMoney.text(t.formatMoney(rowMultiple*e))})}n=t.getNormalTable().find("tr"),n.each(function(){r=$(this),rowMoney=r.find(".trace-row-money"),rowMultiple=Number(r.find(".trace-row-multiple").val()),rowMoney.text(t.formatMoney(rowMultiple*e))})},getWinMoney:function(){var e=this,t=e.getOrderData().orders,n=0,r=t.length,i=0;for(;n<r;n++)i+=e.getPlayGroupMoneyByGameMethodName(t[n].mid)*t[n].moneyUnit;return i},confirmSetting:function(){var e=this;e.setOrderData(u.getCurrentGameOrder().getTotal()),e.buildDetail()},isMoreBounsMethod:function(){var e=this,t=e.getOrderData().orders,n=0,r=t.length;for(;n<r;n++){type=t[n].type;if(typeof u.currentIsMoreBouns["moreBouns"][type]!="undefined"&&u.currentIsMoreBouns["moreBouns"][type]==1)return t[n].typeText}return""},isSameGameMethod:function(){var e=this,t=e.getOrderData().orders,n="",r=-1;i=0,len=t.length;for(;i<len;i++){if(n!=""){if(n!=t[i]["type"])return!1}else n=t[i].type;if(r!=-1){if(r!=t[i]["moneyUnit"])return!1}else r=t[i].moneyUnit}return!0},getSameGameMethodName:function(){var e=this,t=e.getOrderData().orders;if(t.length>0)return t[0].type},getSameGameMoneyUnti:function(){var e=this,t=e.getOrderData().orders;if(t.length>0)return t[0].moneyUnit},setOrderData:function(e){this.orderData=e},getOrderData:function(){return this.orderData==null?{count:0,amount:0,orders:[]}:this.orderData},getStartNumberIndexByNumber:function(e){var t=this,n=u.getCurrentGame().getGameConfig().getInstance().getGameNumbers(),r=n.length,i=0;for(;i<r;i++)if(n[i]["number"]==e)return i;return-1},getStartNumberByIndex:function(e){var t=this,n=u.getCurrentGame().getGameConfig().getInstance().getGameNumbers();return n.length>e?n[e]:{}},buildDetail:function(){var e=this,t=e.getTraceType(),n=u.getCurrentGameMessage();e.setOrderData(u.getCurrentGameOrder().getTotal()),orderAmount=e.getOrderData().amount;if(t!="normal"&&orderAmount<=0){n.show({type:"mustChoose",msg:"请至少选择一注投注号码！",data:{tplData:{msg:"请至少选择一注投注号码！"}}});return}$.isFunction(e["trace_"+t])&&e["trace_"+t].call(e),e.updateStatistics()},trace_normal:function(){var e=this,t=e.defConfig,n=t.dataRowTemplate,r=[],i=e.getTraceType(),s=e.getTimes(),o=e.getMultiple(),a=u.getCurrentGameOrder().getOrderMaxMultiple().maxnum,f=0,l=0,c=u.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),h='<span class="icon-period-current"></span>',p="",d=e.traceStartNumberSelect.getValue(),v,m,g;e.setOrderData(u.getCurrentGameOrder().getTotal()),f=e.getOrderData().amount,r.push(t.dataRowHeader),v=e.getStartNumberIndexByNumber(d),l=v,s+=l;for(;l<s;l++)m=e.getStartNumberByIndex(l),p=m.number,p==c&&(p+=h),m.number&&(g={No:l+1,traceNumber:p,issueCode:m.issueCode,multiple:o,money:e.formatMoney(f*o),publishTime:m.time},r.push(e.formatRow(n,g)));e.getRowTable().html(r.join("")),e.getRowTable().attr("data-type","trace_normal")},trace_advanced:function(){var e=this,t=e.getTraceType(),n=e.getAdvancedType(),r=e.getTypeTypeType(),i="trace_"+t+"_"+n+"_"+r,s="",o="",a=e.isMoreBounsMethod();if(n!="fanbei")if(!e.isSameGameMethod()&&(n=="yingli"||n=="yinglilv")||a!=""){n=="yingli"?s="盈利金额追号":n=="yinglilv"?s="盈利率追号":s="盈利追号方式",e.isSameGameMethod()?a!=""&&(o=s+"时，"+a+",为多奖金玩法，不支持盈利金额和盈利率追号"):o=s+"不支持混投<br />请确保您的投注都为同一玩法类型<br />且元角模式一致。",e.getRowTable().html(""),u.getCurrentGameMessage().show({type:"mustChoose",msg:"",data:{tplData:{msg:o}}});return}$.isFunction(e[i])&&e[i](),e.getRowTable().attr("data-type",i)},trace_advanced_fanbei_a:function(e){var t=this,n=t.defConfig.dataRowTemplate,r=[],i=t.getTimes(),s=u.getCurrentGameOrder().getOrderMaxMultiple(),o=e||s.maxnum,a=u.getCurrentGame().getGameConfig().getInstance().getTitleByName(s.gameMethod).join("-"),f=Number($("#J-trace-advanced-fanbei-a-jiange").val()),l=t.getMultiple(),c=l,h=t.getTraceTypeFunction(),p=Number($("#J-trace-advanced-fanbei-a-multiple").val()),d,v=0,m=f,g=u.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),y='<span class="icon-period-current"></span>',b="",w=t.traceStartNumberSelect.getValue(),E,S,x,T="",N="";r.push(t.defConfig.dataRowHeader),E=t.getStartNumberIndexByNumber(w),v=E,i+=v,S=t.getStartNumberByIndex(v),console.log(h);for(;v<i;v++){m<=0&&(m=f,h==1?c=c*=p:c=c+=p),m--;if(c>o){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){t.trace_advanced_fanbei_a(o),t.updateStatistics(),this.hide()},data:{tplData:{msg:"翻倍追号中的<b>["+a+"]</b>的倍数超过了最大倍数限制，系统将自动调整为最大可设置倍数"}}});if(!e)return}c=c>o?o:c,S=t.getStartNumberByIndex(v);if(!S.number)break;b=S.number,b==g&&(b+=y),x={No:N,traceNumber:b,issueCode:S.issueCode,multiple:c,money:t.formatMoney(orderAmount*c),publishTime:S.time},T=b.substr(0,8),r.push(t.formatRow(n,x))}t.getRowTable().html(r.join(""))},trace_advanced_fanbei_b:function(){var e=this,t=e.defConfig.dataRowTemplate,n=[],r=e.getTimes(),i=u.getCurrentGameOrder().getOrderMaxMultiple().maxnum,s=Number($("#J-trace-advanced-fanbei-a-jiange").val()),o=e.getMultiple(),a=1,f=Number($("#J-trace-advanced-fanbei-a-multiple").val()),l,c=0,h=s,p=Number($("#J-trace-advanced-fanbei-b-num").val()),d=Number($("#J-trace-advance-multiple").val()),v=Number($("#J-trace-advanced-fanbei-b-multiple").val()),m=u.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),g='<span class="icon-period-current"></span>',y="",b=e.traceStartNumberSelect.getValue(),w,E,S,x="",T="";n.push(e.defConfig.dataRowHeader),w=e.getStartNumberIndexByNumber(b),c=w,r+=c,E=e.getStartNumberByIndex(c);for(;c<r;c++){c<p+w?a=d>i?i:d:a=v>i?i:v,E=e.getStartNumberByIndex(c);if(!E.number)break;y=E.number,y==m&&(y+=g),S={No:T,traceNumber:y,issueCode:E.issueCode,multiple:a,money:e.formatMoney(orderAmount*a),publishTime:E.time},x=y.substr(0,8),n.push(e.formatRow(t,S))}e.getRowTable().html(n.join(""))},trace_advanced_yingli_a:function(e){var t=this,n=t.defConfig.dataRowTemplate,r=[],i=t.getTimes(),s=u.getCurrentGameOrder().getOrderMaxMultiple(),o=e||s.maxnum,a=u.getCurrentGame().getGameConfig().getInstance().getTitleByName(s.gameMethod).join("-"),f=t.getMultiple(),l=1,c,h=0,p=t.getSameGameMethodName(),d=Number($("#J-trace-advanced-yingli-a-money").val()),v=t.getSameGameMoneyUnti(),m=t.getWinMoney(),f,n=t.defConfig.dataRowYingliTemplate,g=t.getOrderData().orders,y=0,b=0,w=0,E=0,S=u.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),x='<span class="icon-period-current"></span>',T="",N=t.traceStartNumberSelect.getValue(),C,k,L,A="",O="";r.push(t.defConfig.dataRowYingliHeader),C=t.getStartNumberIndexByNumber(N),h=C,i+=h,k=t.getStartNumberByIndex(h);for(;h<i;h++){y=0,w=0,$.each(g,function(e){var t=this,n=t.num,r=t.onePrice,i=t.multiple,s=n*i*r*v,o=m*i;w+=o,y+=s});if(f<0){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){this.hide()},data:{tplData:{msg:"您设置的盈利金额追号参数过高，无法达到您预期的目标值，请您重新修改参数设置。"}}}),t.getRowTable().html("");return}if(f>o){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){t.trace_advanced_yingli_a(o),t.updateStatistics(),this.hide()},data:{tplData:{msg:"盈利金额追号中的<b>["+a+"]</b>的倍数超过了最大倍数限制，系统将自动调整为最大可设置倍数"}}}),f=e;if(!e)return;f=e}var M=!1,_=99999;e:for(var D=0;D<=99999;D++){var P=y,H=b,B=w,j=E;P*=f,H+=P,B=m*f-H,j=B/H;if(!(B<d)){M=!0,y=P,b=H,w=B,E=j;break e}f++}if(f>_&&!M&&!h){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){this.hide()},data:{tplData:{msg:"您设置的盈利金额追号参数过高，无法达到您预期的目标值，请您重新修改参数设置。"}}}),t.getRowTable().html("");return}if(f>_){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){this.hide()},data:{tplData:{msg:"您设置的盈利金额追号参数过高，无法达到您预期的目标值，请您重新修改参数设置。"}}});break}k=t.getStartNumberByIndex(h);if(!k.number)break;T=k.number,T==S&&(T+=x),L={No:O,traceNumber:T,issueCode:k.issueCode,multiple:f,money:t.formatMoney(y),userGroupMoney:t.formatMoney(m*f),winTotalAmout:t.formatMoney(w),yinglilv:Number(E*100).toFixed(2)},A=T.substr(0,8),r.push(t.formatRow(n,L))}t.getRowTable().html(r.join("")),t.trace_row_empty()},trace_advanced_yingli_b:function(e){var t=this,n=t.defConfig.dataRowTemplate,r=[],i=t.getTimes(),s=u.getCurrentGameOrder().getOrderMaxMultiple(),o=e||s.maxnum,a=u.getCurrentGame().getGameConfig().getInstance().getTitleByName(s.gameMethod).join("-"),f=t.getMultiple(),l=1,c,h=0,p=t.getSameGameMethodName(),d=Number($("#J-trace-advanced-yingli-b-num").val()),v=Number($("#J-trace-advanced-yingli-b-money1").val()),m=Number($("#J-trace-advanced-yingli-b-money2").val()),g=t.getSameGameMoneyUnti(),y=t.getWinMoney(),f,n=t.defConfig.dataRowYingliTemplate,b=t.getOrderData().orders,w=0,E=0,S=0,x=0,T=u.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),N='<span class="icon-period-current"></span>',C="",k=t.traceStartNumberSelect.getValue(),L,A,O,M="",_="";r.push(t.defConfig.dataRowYingliHeader),L=t.getStartNumberIndexByNumber(k),h=L,i+=h,A=t.getStartNumberByIndex(h);for(;h<i;h++){h+1>d+L&&(v=m),w=0,S=0,$.each(b,function(e){var t=this,n=t.num,r=t.onePrice,i=t.multiple,s=n*i*r*g,o=y*i;S+=o,w+=s});if(f<0){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){this.hide()},data:{tplData:{msg:"您设置的盈利金额追号参数过高，无法达到您预期的目标值，请您重新修改参数设置。"}}}),t.getRowTable().html("");return}if(f>o){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){t.trace_advanced_yingli_b(o),t.updateStatistics(),this.hide()},data:{tplData:{msg:"盈利金额追号中的<b>["+a+"]</b>的倍数超过了最大倍数限制，系统将自动调整为最大可设置倍数"}}}),f=e;if(!e)return;f=e}var D=!1,P=99999;e:for(var H=0;H<=99999;H++){var B=w,j=E,F=S,I=x;B*=f,j+=B,F=y*f-j,I=F/j;if(!(F<v)){D=!0,w=B,E=j,S=F,x=I;break e}f++}if(f>P&&!D&&!h){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){this.hide()},data:{tplData:{msg:"您设置的盈利金额追号参数过高，无法达到您预期的目标值，请您重新修改参数设置。"}}}),t.getRowTable().html("");return}if(f>P){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){this.hide()},data:{tplData:{msg:"您设置的盈利金额追号参数过高，无法达到您预期的目标值，请您重新修改参数设置。"}}});break}A=t.getStartNumberByIndex(h);if(!A.number)break;C=A.number,C==T&&(C+=N),O={No:_,traceNumber:C,issueCode:A.issueCode,multiple:f,money:t.formatMoney(w),userGroupMoney:t.formatMoney(y*f),winTotalAmout:t.formatMoney(S),yinglilv:Number(x*100).toFixed(2)},M=C.substr(0,8),r.push(t.formatRow(n,O))}t.getRowTable().html(r.join("")),t.trace_row_empty()},trace_advanced_yinglilv_a:function(e){var t=this,n=t.defConfig.dataRowTemplate,r=[],i=t.getTimes(),s=u.getCurrentGameOrder().getOrderMaxMultiple(),o=e||s.maxnum,a=u.getCurrentGame().getGameConfig().getInstance().getTitleByName(s.gameMethod).join("-"),f=t.getMultiple(),l=1,c,h=0,p=t.getSameGameMethodName(),d=Number($("#J-trace-advanced-yinglilv-a").val())/100,v=0,m=t.getSameGameMoneyUnti(),g=t.getWinMoney(),f,n=t.defConfig.dataRowYingliTemplate,y=t.getOrderData().orders,b=0,w=0,E=0,S=u.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),x='<span class="icon-period-current"></span>',T="",N=t.traceStartNumberSelect.getValue(),C,k,L,A="",O="";r.push(t.defConfig.dataRowYingliHeader),C=t.getStartNumberIndexByNumber(N),h=C,i+=h,k=t.getStartNumberByIndex(h);for(;h<i;h++){b=0,E=0,$.each(y,function(e){var t=this,n=t.num,r=t.onePrice,i=t.multiple,s=n*i*r*m,o=g*i;E+=o,b+=s});if(f<0){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){this.hide()},data:{tplData:{msg:"您设置的盈利率追号参数过高，无法达到您预期的目标值，请您重新修改参数设置。"}}}),t.getRowTable().html("");return}if(f>o){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){t.trace_advanced_yinglilv_a(o),t.updateStatistics(),this.hide()},data:{tplData:{msg:"盈利率追号中的<b>["+a+"]</b>的倍数超过了最大倍数限制，系统将自动调整为最大可设置倍数"}}}),f=e;if(!e)return;f=e}var M=!1,_=99999;e:for(var D=0;D<=99999;D++){var P=b,H=w,B=E,j=0;P*=f,H+=P,B=g*f-H,j=B/H;if(!(j<d)){M=!0,b=P,w=H,E=B;break e}f++}if(f>_&&!M&&!h){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){this.hide()},data:{tplData:{msg:"您设置的盈利金额追号参数过高，无法达到您预期的目标值，请您重新修改参数设置。"}}}),t.getRowTable().html("");return}if(f>_){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){this.hide()},data:{tplData:{msg:"您设置的盈利金额追号参数过高，无法达到您预期的目标值，请您重新修改参数设置。"}}});break}k=t.getStartNumberByIndex(h);if(!k.number)break;T=k.number,T==S&&(T+=x),L={No:O,traceNumber:T,issueCode:k.issueCode,multiple:f,money:t.formatMoney(b),userGroupMoney:t.formatMoney(g*f),winTotalAmout:t.formatMoney(E),yinglilv:Number(E/w*100).toFixed(2)},r.push(t.formatRow(n,L))}A=T.substr(0,8),t.getRowTable().html(r.join("")),t.trace_row_empty()},trace_advanced_yinglilv_b:function(e){var t=this,n=t.defConfig.dataRowTemplate,r=[],i=t.getTimes(),s=u.getCurrentGameOrder().getOrderMaxMultiple(),o=e||s.maxnum,a=u.getCurrentGame().getGameConfig().getInstance().getTitleByName(s.gameMethod).join("-"),f=t.getMultiple(),l=1,c,h=0,p=t.getSameGameMethodName(),d=Number($("#J-trace-advanced-yinglilv-b-num").val()),v=Number($("#J-trace-advanced-yingli-b-yinglilv1").val())/100,m=Number($("#J-trace-advanced-yingli-b-yinglilv2").val())/100,g=0,y=0,b=t.getSameGameMoneyUnti(),w=t.getWinMoney(),f,n=t.defConfig.dataRowYingliTemplate,E=t.getOrderData().orders,S=0,x=0,T=0,N=u.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),C='<span class="icon-period-current"></span>',k="",L=t.traceStartNumberSelect.getValue(),A,O,M,_="",D="";r.push(t.defConfig.dataRowYingliHeader),A=t.getStartNumberIndexByNumber(L),h=A,i+=h,O=t.getStartNumberByIndex(h);for(;h<i;h++){S=0,T=0,$.each(E,function(e){var t=this,n=t.num,r=t.onePrice,i=t.multiple,s=n*i*r*b,o=n*w*i;T+=o,S+=s}),h<d+A?g=v:g=m;if(f<0){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){this.hide()},data:{tplData:{msg:"您设置的盈利率追号参数过高，无法达到您预期的目标值，请您重新修改参数设置。"}}}),t.getRowTable().html("");return}if(f>o){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){t.trace_advanced_yinglilv_a(o),t.updateStatistics(),this.hide()},data:{tplData:{msg:"盈利率追号中的<b>["+a+"]</b>的倍数超过了最大倍数限制，系统将自动调整为最大可设置倍数"}}}),f=e;if(!e)return;f=e}var P=!1,H=99999;e:for(var B=0;B<=99999;B++){var j=S,F=x,I=T,q=0;j*=f,F+=j,I=w*f-F,q=I/F;if(!(q<g)){P=!0,S=j,x=F,T=I;break e}f++}if(f>H&&!P&&!h){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){this.hide()},data:{tplData:{msg:"您设置的盈利金额追号参数过高，无法达到您预期的目标值，请您重新修改参数设置。"}}}),t.getRowTable().html("");return}if(f>H){u.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){this.hide()},data:{tplData:{msg:"您设置的盈利金额追号参数过高，无法达到您预期的目标值，请您重新修改参数设置。"}}});break}O=t.getStartNumberByIndex(h);if(!O.number)break;k=O.number,k==N&&(k+=C),M={No:D,traceNumber:k,issueCode:O.issueCode,multiple:f,money:t.formatMoney(S),userGroupMoney:t.formatMoney(w*f),winTotalAmout:t.formatMoney(T),yinglilv:Number(T/x*100).toFixed(2)},_=k.substr(0,8),r.push(t.formatRow(n,M))}t.getRowTable().html(r.join("")),t.trace_row_empty()},trace_row_empty:function(){$("#J-trace-table-advanced-body .trace-row-number").size()<=0&&u.getCurrentGameMessage().show({type:"normal",closeText:"返回",closeFun:function(){this.hide()},data:{tplData:{msg:"设置参数有误！无法实现您设定的盈利参数！"}}})},getMultipleByYinglilv:function(e,t,n,r){var i=1,s=1e5;for(;i<s;i++)if((t*i-n*i-r)/(n*i+r)>=e)return i;return-1},getMultipleByMoney:function(e,t,n,r){var i=1,s=1e5;for(;i<s;i++)if(e*i-r-n*i>t)return i;return-1},getPlayGroupMoneyByGameMethodName:function(e){return Number(u.getCurrentGame().getGameConfig().getInstance().getPrizeById(e).prize)},formatRow:function(e,t){var n=this,r=t,i,s;for(i in r)r.hasOwnProperty(i)&&(s=RegExp("<#="+i+"#>","g"),e=e.replace(s,r[i]));return e},formatMoney:function(e){var e=Number(e),t=/(-?\d+)(\d{3})/;Number.prototype.toFixed?e=e.toFixed(2):e=Math.round(e*100)/100,e=""+e;while(t.test(e))e=e.replace(t,"$1,$2");return e},getAdvancedTable:function(){var e=this;return e._advancedTable||(e._advancedTable=$("#J-trace-table-advanced"))},getAdvancedRowTable:function(){var e=this;return e._advancedTableContainer||(e._advancedTableContainer=$("#J-trace-table-advanced-body"))},getNormalTable:function(){var e=this;return e._table||(e._table=$("#J-trace-table"))},getNormalRowTable:function(){var e=this;return e._tableContainer||(e._tableContainer=$("#J-trace-table-body"))},getTable:function(){var e=this;return e.isAdvanced()?e._advancedTable||(e._advancedTable=$("#J-trace-table-advanced")):e._table||(e._table=$("#J-trace-table"))},getRowTable:function(){var e=this;return e.isAdvanced()?e._advancedTableContainer||(e._advancedTableContainer=$("#J-trace-table-advanced-body")):e._tableContainer||(e._tableContainer=$("#J-trace-table-body"))},setCurrentTraceNumber:function(e){var t=this;t.currentTraceNumber=e},getCurrentTraceNumber:function(){return me.currentTraceNumber},setTraceStartNumber:function(e){var t=this;t.traceStartNumber=e},getTraceStartNumber:function(){return me.traceStartNumber},getMultiple:function(){var e=this;return e.isAdvanced()?e.getAdvancedMultiple():e.getNormalMultiple()},getNormalMultiple:function(){return Number(this.normalSelectMultiple.getValue())},getAdvancedMultiple:function(){return Number($("#J-trace-advance-multiple").val())},getTraceTypeFunction:function(){return Number($("#J-trace-advanced-fanbei-function").val())},setIsWinStop:function(e){var t=this;this.isWinStop=!!e},getTimes:function(){var e=this;return e.isAdvanced()?e.getAdvancedTimes():Number($("#J-trace-normal-times").val())},getAdvancedTimes:function(){return Number($("#J-trace-advanced-times").val())},isAdvanced:function(){var e=this;return e.traceType=="advanced"},setTraceType:function(e){var t=this;e!=t.traceType&&(e=e?e:"normal",t.traceType=e)},getTraceType:function(){return this.traceType},getRowTableType:function(){var e=this;return e.getRowTable().attr("data-type")},emptyRowTable:function(){var e=this;$("#J-trace-table-body").html(""),$("#J-trace-table-advanced-body").html(""),e.updateStatistics()},checkTraceAvailabity:function(){var e=this,t=u.getCurrentGameOrder().getTotal().amount,n=u.getCurrentGameMessage();return t<=0?(n.show({type:"mustChoose",msg:"请至少选择一注投注号码！",data:{tplData:{msg:"请至少选择一注投注号码！"}}}),!1):(u.getCurrentGameOrder().editMultiples(1),!0)},show:function(){var e=this,t=u.getCurrentGameOrder().getTotal().amount,n=u.getCurrentGameMessage();if(t<=0){n.show({type:"mustChoose",msg:"请至少选择一注投注号码！",data:{tplData:{msg:"请至少选择一注投注号码！"}}});return}u.getCurrentGameOrder().editMultiples(1),e.showPanel()},hide:function(){var e=this;e.hidePanel(),e.getIsTrace()==1?u.getCurrentGameOrder().editMultiples(1):u.getCurrentGameOrder().restoreMultiples()},showPanel:function(){var t=this;e.Mask.getInstance().show(),t.panel.show()},hidePanel:function(){var t=this;e.Mask.getInstance().hide(),t.panel.hide()},applyTraceData:function(){var e=this,t=Number($.trim($("#J-trace-statistics-times").text())),n=Number($.trim($("#J-trace-statistics-lotterys-num").text())),r=Number($.trim($("#J-trace-statistics-amount").text().replace(/[^\d|\.]/g,"")));t>0?(e.setIsTrace(1),u.getCurrentGameOrder().setTotalLotterysNum(n),u.getCurrentGameOrder().setTotalAmount(r)):(u.getCurrentGameOrder().restoreMultiples(),e.setIsTrace(0),e.hide())},deleteTrace:function(){var e=this;u.getCurrentGameOrder().restoreMultiples(),e.setIsTrace(0),e.emptyRowTable(),$("#J-trace-num-tip-panel").hide(),e.getTbodys().html("")},getTbodys:function(){var e=this;return e.panel.find("tbody[data-type]")},autoDeleteTrace:function(){var t=this,n=new e.Tip({cls:"j-ui-tip-b"});t.deleteTrace(),setTimeout(function(){n.getDom().fadeOut()},2e3)},reSetTab:function(){var e=this,t=e.TraceTab,n=e.TraceAdvancedTab;t.triggers.removeClass(t.defConfig.currClass),t.triggers.eq(0).addClass(t.defConfig.currClass),t.panels.removeClass(t.defConfig.currPanelClass),t.panels.eq(0).addClass(t.defConfig.currPanelClass),t.index=0,n.triggers.removeClass(n.defConfig.currClass),n.triggers.eq(0).addClass(n.defConfig.currClass),n.panels.removeClass(n.defConfig.currPanelClass),n.panels.eq(0).addClass(n.defConfig.currPanelClass),n.index=0,$("#J-trace-normal-times").val(10),$("#J-function-select-tab .function-select-title li").removeClass("current").eq(1).addClass("current"),e.normalSelectMultiple.setValue(1),$("#J-trace-advanced-times").val(10),$("#J-trace-advance-multiple").val(1),$("#J-trace-advanced-fanbei-a-jiange").val(2),$("#J-trace-advanced-fanbei-a-multiple").val(2),$("#J-trace-advanced-fanbei-b-num").val(5),$("#J-trace-advanced-fanbei-b-multiple").val(3),$("#J-trace-advanced-yingli-a-money").val(100),$("#J-trace-advanced-yingli-b-num").val(2),$("#J-trace-advanced-yingli-b-money1").val(100),$("#J-trace-advanced-yingli-b-money2").val(50),$("#J-trace-advanced-yinglilv-a").val(10),$("#J-trace-advanced-yinglilv-b-num").val(5),$("#J-trace-advanced-yingli-b-yinglilv1").val(30),$("#J-trace-advanced-yingli-b-yinglilv2").val(10),e.setTraceType("normal"),e.advancedType=e.defConfig.advancedTypeHas[0],e.typeTypeType="a",$("#J-trace-advanced-type-panel").find('input[type="radio"]').each(function(e){if((e+1)%2!=0){var t=$(this),n=t.parent(),r=n.parent().children(),i;this.checked=!0,r.each(function(e){i=r.get(e),n.get(0)!=i?$(i).find('input[type="text"]').attr("disabled","disabled"):$(i).find('input[type="text"]').attr("disabled",!1)})}})}},c=e.Class(l,n);c.defConfig=s,c.getInstance=function(e){return o||(o=new c(e))},e[t]=c})(caipiaogame,"GameTrace",caipiaogame.Event);(function(host,name,Event,undefined){var defConfig={},instance,Games=host.Games,pros={init:function(e){var t=this,e=t.defConfig;t.postLock=null,Games.setCurrentGameSubmit(t)},getSubmitData:function(e){var t=this,n={},r=e?Games.getCurrentGameOrder().fastOrderData:Games.getCurrentGameOrder().orderData,i=0,s=r.length,o=Games.getCurrentGameTrace().getResultData(),u=0,a=o.traceData.length;n.gameId=Games.getCurrentGame().getGameConfig().getInstance().getGameId(),n.isTrace=Games.getCurrentGameTrace().getIsTrace(),n.traceWinStop=Games.getCurrentGameTrace().getIsWinStop(),n.traceStopValue=Games.getCurrentGameTrace().getTraceWinStopValue(),n.balls=[];for(;i<s;i++)n.balls.push({jsId:r[i].id,wayId:r[i].mid,ball:r[i].postParameter.split(",").join("|"),viewBalls:r[i].viewBalls,num:r[i].num,type:r[i].type,onePrice:r[i].onePrice,moneyunit:r[i].moneyUnit,multiple:r[i].multiple,prizeGroup:r[i].prizeGroup,extra:r[i].extra});n.orders={};if(n.isTrace<1)n.orders[Games.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber()]=1,n.amount=Games.getCurrentGameOrder().getTotal().amount;else{for(;u<a;u++)n.orders[o.traceData[u].traceNumber]=o.traceData[u].multiple;n.amount=o.amount.toFixed(4)}return n},doPostLock:function(){var e=this;e.postLock=!0},cancelPostLock:function(){var e=this;e.postLock=!1},clearData:function(){var e=Games.getCurrentGameOrder();e.reSet(),e.cancelSelectOrder(),Games.getCurrentGame().getCurrentGameMethod().reSet(),Games.getCurrentGameTrace().emptyRowTable()},getCompressData:function(data){var me=this,binaryString,forIn=function(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])},each=function(e,t){for(var n=0,r=e.length;n<r;n+=1)t(n,e[n])};return JSON||(JSON={}),JSON.parse||(JSON.parse=function(json){return eval("1,"+json)}),JSON.stringify||function(e){function r(){var e="{";return forIn(json,function(r,i){var s=Object.prototype.toString.call(i);s==t?e+=r+":"+ArrPartten(i)+",":s==n?e+=r+":"+ObjectJson(i)+",":e+=r+":"+i+","}),e.length!=1&&(e=e.substring(0,e.length-1)),e+"}"}function i(){var e="[";return each(json,function(r,i){var s=Object.prototype.toString.call(i);s==t?e+=ArrPartten(i)+",":s==n?e+=ObjectJson(i)+",":e+=i+","}),json.length>0&&(e=e.substring(0,e.length-1)),e+"]"}var t="[object Array]",n="[object Object]";e.stringify=function(e){var r="",i=Object.prototype.toString.call(e);return i==t?r=ArrPartten(e):i==n?r=ObjectJson(e):r=e,r}}(JSON),binaryString=pako.deflate(JSON.stringify(Games.getCurrentGame().editSubmitData(data)),{to:"string"}),binaryString=window.btoa(binaryString),binaryString=pako.deflate(JSON.stringify(binaryString),{to:"string"}),binaryString=window.btoa(binaryString),binaryString=pako.deflate(JSON.stringify(binaryString),{to:"string"}),binaryString=window.btoa(binaryString),binaryString},submitData:function(e){var t=this,n=e||!1,r=t.getSubmitData(),i=Games.getCurrentGameMessage(),s;if(t.postLock)return;if(r.balls.length<=0){i.show({type:"mustChoose",msg:"请至少选择一注投注号码！",data:{tplData:{msg:"请至少选择一注投注号码！"}}}),t.cancelPostLock();return}i.show({type:"checkLotters",msg:"请核对您的投注信息！",confirmIsShow:!0,confirmFun:function(){if(t.postLock)return;n&&n=="1"?s={compressedBetData:encodeURIComponent(t.getCompressData(r))}:s=Games.getCurrentGame().editSubmitData(r),$.ajax({url:Games.getCurrentGame().getGameConfig().getInstance().getSubmitUrl(),data:s,dataType:"json",method:"POST",beforeSend:function(){t.doPostLock(),t.fireEvent("beforeSend",i)},success:function(e){var n=i.win.dom.find(".pop-control"),r=n.find("a.cancel").addClass("printBtn"),s=n.find("a.printBtn"),o=n.find("a.confirm");Number(e["isSuccess"])==1?(e.confirmIsShow=!0,i.show(e),e["Msg"]=="投注成功"?(s.text("打 印"),o.hide(),s.show()):s.text("确定"),s.click(function(e){if($(this).hasClass("printBtn")){var r=i.win.dom.find("[bet-content]").attr("bet-content");i.win.hide(),t.printSeverData(r),s.text("确 认"),n.find("a.cancel").removeClass("printBtn")}}),t.clearData(),t.fireEvent("afterSubmitSuccess")):(i.show(e),s.text("确定")),t.cancelPostLock()},complete:function(){t.fireEvent("afterSubmit",i)},error:function(e){var n=caipiaogame.Games.getCurrentGameMessage();n.win.dom.find(".pop-control").find("a.cancel").removeClass("printBtn"),n.hide(),n.show({mask:!0,closeIsShow:!0,closeFun:function(){n.hide()},content:'<div class="pop-waring"><i class="ico-waring"></i><h4 class="pop-text">网络连接超时,请刷新页面后,在"游戏记录"中查询投注结果</h4></div>'}),t.cancelPostLock()}})},cancelIsShow:!0,cancelFun:function(){t.cancelPostLock(),this.hide()},normalCloseFun:function(){t.cancelPostLock()},callback:function(){},data:{tplData:{lotteryDate:"--",lotteryName:Games.getCurrentGame().getGameConfig().getInstance().getGameNameCn(),lotteryInfo:function(){var e="",t=Games.getCurrentGame().getGameConfig().getInstance(),n=r.balls,i=["万","千","百","十","个"];for(var s=0;s<n.length;s++){var o=n[s],u=t.getMethodCnFullNameById(o.wayId),a="";if(o.extra.position){var f=[];for(var l=0;l<o.extra.position.length;l++)f.push("<i>"+i[o.extra.position[l]]+"</i>");a=f.join("")}u[0]==u[1]&&u[1]==u[2]?u=t.getMethodCnFullNameById(o.wayId)[2]:u=u.join(","),e+='<div class="game-submit-confirm-list">'+u+" "+a+o.viewBalls+"</div>"}return e},lotteryamount:host.util.formatMoney(r.amount,3),lotteryAcc:Games.getCurrentGame().getGameConfig().getInstance().getUserName(),lotterOptionalPrizes:Games.getCurrentGame().getGameConfig().getInstance().setOptionalPrizes()}}})},fastSubmitData:function(e,t){var n=this,r=t==0?!1:!0,i=e||!1,s=n.getSubmitData(!0),o=Games.getCurrentGameMessage(),u;if(n.postLock)return;i&&i=="1"?u={compressedBetData:encodeURIComponent(n.getCompressData(s))}:u=Games.getCurrentGame().editSubmitData(s),$.ajax({url:Games.getCurrentGame().getGameConfig().getInstance().getSubmitUrl(),data:u,dataType:"json",method:"POST",beforeSend:function(){n.doPostLock(),n.fireEvent("beforeSend",o),o.showTip("提交中...")},success:function(e){o.hideTip();var t=o.win.dom.find(".pop-control"),r=t.find("a.cancel").addClass("printBtn"),i=t.find("a.printBtn"),s=t.find("a.confirm");Number(e["isSuccess"])==1?(e.confirmIsShow=!0,o.show(e),e["Msg"]=="投注成功"?(i.text("打 印"),s.hide(),i.show()):i.text("确定"),i.click(function(e){if($(this).hasClass("printBtn")){var r=o.win.dom.find("[bet-content]").attr("bet-content");o.win.hide(),n.printSeverData(r),i.text("确 认"),t.find("a.cancel").removeClass("printBtn")}}),n.clearData(),n.fireEvent("afterSubmitSuccess")):(o.show(e),i.text("确定")),n.cancelPostLock()},complete:function(){n.fireEvent("afterSubmit",o),o.hideTip()},error:function(e){var t=caipiaogame.Games.getCurrentGameMessage();t.hide(),t.show({mask:!0,confirmIsShow:!0,confirmText:"关 闭",confirmFun:function(){t.hide()},content:'<div class="pop-waring"><i class="ico-waring"></i><h4 class="pop-text">服务器信息错误,请在投注列表中查询</h4></div>'}),n.cancelPostLock()}})},printSeverData:function(e){var t,n=[],r=function(e){var t=window.document.body.innerHTML,n="<!--startprint-->",r="<!--endprint-->",i=t.substr(t.indexOf(n)+17),i=i.substring(0,i.indexOf(r)),s=document.getElementById("printf");s.contentDocument.write(e.join("")),s.contentDocument.close(),s.contentWindow.print()};$.ajax({url:"/boughts/"+e+"/print",type:"GET",dataType:"json"}).done(function(e){e!=null&&(n.push("<p>彩种："+Games.getCurrentGame().getGameConfig().getInstance().getGameNameCn()+"</p>"),n.push("<p>期号：第"+e.issue+"期</p>"),$.each(e.items,function(e,t){n.push("<p>"+t.title+"</p>"),n.push("<p>"+t.display_bet_number+'<span style="float:right">金额：￥'+t.amount_formatted+"元</span></p>")}),n.push("<p>购买时间："+e.created_at.date+"</p>"),n.push("<p >投注总金额："+e.total_amount+" 元</p>"),r(n))}).fail(function(){}).always(function(){})}},Main=host.Class(pros,Event);Main.defConfig=defConfig,Main.getInstance=function(e){return instance||(instance=new Main(e))},host[name]=Main})(caipiaogame,"GameSubmit",caipiaogame.Event);(function(e,t,n,r){var i={mainPanel:"#J-balls-statistics-panel",lotteryNumDom:"#J-balls-statistics-lotteryNum",multipleDom:"#J-balls-statistics-multiple",multipleDomFixed:"#J-multiple-fixed",amountDom:"#J-balls-statistics-amount",moneyUnitDom:"#J-balls-statistics-moneyUnit",moneyUnitTriggerDom:"#J-balls-statistics-moneyUnit-trigger",rebateDom:"#J-balls-statistics-rebate",moneyUnit:gameConfigData.defaultCoefficient,moneyUnitData:gameConfigData.availableCoefficients,multiple:gameConfigData.defaultMultiple,bonusGroupMax:gameConfigData.maxPrizeGroup,limitData:gameConfigData.wayPrizeLimit,prizeLimit:gameConfigData.prizeLimit},s,o=e.Games,u={init:function(e){var t=this;o.setCurrentGameStatistics(t),t.panel=$(e.mainPanel),t.moneyUnit=e.moneyUnit,t.multiple=e.multiple,t.lotteryData=[],t.multipleDom=new caipiaogame.Select({cls:"select-game-statics-multiple",realDom:e.multipleDom,isInput:!0,isCounter:!0,expands:{inputEvent:function(){var e=this;this.getInput().keyup(function(n){var r=this.value,i=o.getCurrentGame().getCurrentGameMethod().getId(),s=t.getMoneyUnit(),u=u=o.getCurrentGame().getGameConfig().getInstance().getLimitByMethodId(i,s)==0?r:o.getCurrentGame().getGameConfig().getInstance().getLimitByMethodId(i,s);this.value=this.value.replace(/[^\d]/g,""),$.trim(this.value)!=""&&(r=Number(this.value),r<1?this.value=1:r>u&&(this.value=u),e.setValue(this.value))}),this.getInput().blur(function(){var n=this.value,r=o.getCurrentGame().getCurrentGameMethod().getId(),i=t.getMoneyUnit(),s=o.getCurrentGame().getGameConfig().getInstance().getLimitByMethodId(r,i)==0?n:o.getCurrentGame().getGameConfig().getInstance().getLimitByMethodId(r,i);this.value=this.value.replace(/[^\d]/g,""),n=Number(this.value),n<1?this.value=1:n>s&&(this.value=s),e.setValue(this.value)})}}}),t.multipleDom.setValue(t.multiple==0?1:t.multiple),t.multipleDom.addEvent("change",function(e,n,r){var i=Number(n),s=o.getCurrentGame().getCurrentGameMethod().getId(),u=t.getMoneyUnit(),a=o.getCurrentGame().getGameConfig().getInstance().getLimitByMethodId(s,u)==0?i:o.getCurrentGame().getGameConfig().getInstance().getLimitByMethodId(s,u);i>a&&(i=a,this.setValue(i)),t.setMultiple(i),t.updateData({lotterys:o.getCurrentGame().getCurrentGameMethod().getLottery(),original:o.getCurrentGame().getCurrentGameMethod().getOriginal()},o.getCurrentGame().getCurrentGameMethod().getName()),$("#J-balls-statistics-multipleNum").text(i)}),t.moneyUnitDom=new caipiaogame.Select({cls:"select-game-statics-moneyUnitDom",realDom:e.moneyUnitDom}),t.moneyUnitDom.setValue(t.moneyUnit),t.moneyUnitDom.addEvent("change",function(e,n,r){var i=t.getMultip(),s=o.getCurrentGame().getCurrentGameMethod().getId(),u=Number(n),a=o.getCurrentGame().getGameConfig().getInstance().getLimitByMethodId(s,u)==0?1:o.getCurrentGame().getGameConfig().getInstance().getLimitByMethodId(s,u);i=i>a?a:i,t.setMultipleDom(i),t.setMoneyUnit(Number(n)),t.multipleDom.setMaxValue(a),t.updateData({lotterys:o.getCurrentGame().getCurrentGameMethod().getLottery(),original:o.getCurrentGame().getCurrentGameMethod().getOriginal()},o.getCurrentGame().getCurrentGameMethod().getName())}),t.hidesetMoneyUnitDom();var n=$(e.moneyUnitTriggerDom);t.setMoneyUnitTriggerDom(n),n.on("click","a[data-value]",function(){var e=$(this).data("value");return e&&!$(this).hasClass("current")&&(t.moneyUnitDom.setValue(e),$(this).addClass("current").siblings().removeClass("current")),!1}),$('a[data-value="'+t.moneyUnit+'"]',n).addClass("current");var r=o.getCurrentGame().getGameConfig().getInstance().getOptionalPrizes(),s=r.length,u=$(".J-prize-group-slider"),a=$("#J-bonus-select-value"),f=u.find("[data-slider-percent]"),l=u.find("[data-slider-value]"),c=s-1,h=i.bonusGroupMax&&i.bonusGroupMax!="0"?i.bonusGroupMax:r[s-1].prize_group;for(;c>=0;c--)if(r[c].prize_group<=h)break;t.bonusGroup=r,t.prizeSlider=new caipiaogame.SliderBar({minDom:"[data-slider-sub]",maxDom:"[data-slider-add]",contDom:"[data-slider-cont]",handleDom:"[data-slider-handle]",innerDom:"[data-slider-inner]",minNumDom:"[data-slider-min]",maxNumDom:"[data-slider-max]",parentDom:u,step:1,minBound:0,maxBound:s-1,rangeBound:[0,c],value:c}),t.prizeSlider.addEvent("change",function(){var e=r[this.getValue()].prize_group,n=r[this.getValue()].rate,i=(n*100).toFixed(2)+"%";a.val(e),f.text(i),l.text(e);var s=t.getResultData();s&&s.amount&&t.setRebate(s.amount,n)}),$(function(){t.prizeSlider.setValue(c)}),t.updateData({lotterys:[],original:[]})},getMultipleTextDom:function(){return $("#J-balls-statistics-multiple-text")},getMoneyUnitText:function(e){return this.defConfig.moneyUnitData[""+e]},updateData:function(e,t){var n=this,r=n.defConfig,i,s=2,u=n.multiple,a=n.moneyUnit;e.lotterys?e.lotterys.constructor===Array?i=e.lotterys.length:i=Number(e.lotterys):i=0,o.getCurrentGame()&&o.getCurrentGame().getCurrentGameMethod()&&(s=o.getCurrentGame().getGameConfig().getInstance().getOnePriceById(o.getCurrentGame().getCurrentGameMethod().getId())),n.setLotteryData(e),n.setMoneyUnitDom(a),n.setLotteryNumDom(i),n.setAmountDom(n.formatMoney(i*a*u*s)),n.fireEvent("afterUpdate",i,i*a*u*s)},getResultData:function(){var e=this,t,n,r=o.getCurrentGame().getCurrentGameMethod(),i=e.getLotteryData();i.lotterys?i.lotterys.constructor===Array?n=i.lotterys.length:n=Number(i.lotterys):n=0;if(n<1)return{};t=o.getCurrentGame().getGameConfig().getInstance().getOnePriceById(r.getId());var s={mid:r.getId(),type:r.getName(),original:i.original,lotterys:i.lotterys,moneyUnit:e.moneyUnit,num:n,multiple:e.multiple,extra:r.getOrderExtraData(),onePrice:t,amount:n*e.moneyUnit*e.multiple*t,amountText:e.formatMoney(n*e.moneyUnit*e.multiple*t),prizeGroup:o.getCurrentGame().getGameConfig().getInstance().setOptionalPrizes(),prizeGroupVal:$("#J-balls-statistics-rebate").text().replace(/,/g,"")};return s},setMoneyUnit:function(e){var t=this;t.moneyUnit=e},getMoneyUnit:function(){return this.moneyUnit},getLotteryData:function(){return this.lotteryData},setLotteryData:function(e){var t=this;t.lotteryData=e},formatMoney:function(e){var e=Number(e),t=/(-?\d+)(\d{3})/;Number.prototype.toFixed?e=e.toFixed(3):e=Math.round(e*100)/100,e=""+e;while(t.test(e))e=e.replace(t,"$1,$2");return e},getLotteryNumDom:function(){var e=this,t=e.defConfig;return e.lotteryNumDom||(e.lotteryNumDom=$(t.lotteryNumDom))},setLotteryNumDom:function(e){var t=this;t.getLotteryNumDom().html(e)},getMultipleDom:function(){return this.multipleDom},getMultip:function(){var e=this;return e.multiple},setMultipleDom:function(e){var t=this;t.getMultipleDom().setValue(e)},setMultiple:function(e){this.multiple=e},getMoneyUnitDom:function(){return this.moneyUnitDom},setMoneyUnitDom:function(e){var t=this,n=e;i.moneyUnitData[e]&&(n=i.moneyUnitData[e]),t.setMoneyUnit(e),$(".select-game-statics-moneyUnitDom input").val(n)},setMoneyUnitTriggerDom:function(e){this.moneyUnitTriggerDom=e},getMoneyUnitTriggerDom:function(){return this.moneyUnitTriggerDom},triggerMoneyUnit:function(e){var t=this,n=$.Event("click"),r=t.getMoneyUnitTriggerDom();n.target=r.find("a[data-value]").filter(function(){return Number($(this).data("value"))==Number(e)})[0],r.trigger(n)},hidesetMoneyUnitDom:function(){this.moneyUnitDom.hide()},getPrizeSlider:function(){return this.prizeSlider},getPrizeGroup:function(){return this.bonusGroup[this.prizeSlider.getValue()].prize_group},getPrizeGroupRate:function(){return this.bonusGroup[this.prizeSlider.getValue()].rate},setSliderValueByPrizeGroup:function(e){var t=-1;$.each(this.bonusGroup,function(n,r){if(r["prize_group"]==e)return t=n}),this.getPrizeSlider().setValue(t)},setRebate:function(t,n){var r=this,i="",s=r.defConfig,o=Math.pow(10,8);if(t<=0||n<=0)i="0.00";else{t=""+parseFloat(t*n*o/o||0),t=t.split(".");if(t[1]){var u=""+t[1];u.length>8&&(u=u.slice(0,8)),i=e.util.formatMoney(t[0],0)+"."+u}else i=e.util.formatMoney(t[0],2)}r.getRebateDom().text(i),this.setTotalBonus()},getRebateDom:function(){var e=this,t=e.defConfig;return e.rebateDom||(e.rebateDom=$(t.rebateDom))},getAmountDom:function(){var e=this,t=e.defConfig;return e.amountDom||(e.amountDom=$(t.amountDom))},setTotalBonus:function(){var t=this,n=t.defConfig,r=o.getCurrentGame().getCurrentGameMethod().getId()||gameConfigData.defaultMethodId,i=o.getCurrentGame().getGameConfig().getInstance().getPrizeById(r),s=s||Number(t.getLotteryNumDom().html()),u=u||Number(t.getAmountDom().html().replace(",","")),a=a||t.getMultip(),f=f||t.getPrizeGroup(),l=l||n.bonusGroupMax,c=c||Number(t.getRebateDom().html().replace(",","")),h=h||n.limitData,p=Number(i.prize)*t.getMoneyUnit(),d=Number(i.all_count),v=s!=0?Number(p*f/l*a-(u+c)).toFixed(3):"0",m=n.prizeLimit,g=gameConfigData.topAgentId,y=n.limitData.default_limit_percent,b=n.limitData.default_limit;n.limitData.users[g]&&(y=n.limitData.users[g].percent,b=n.limitData.users[g].limit);if($.inArray(r,n.limitData.exclude_way_ids)<0&&s/d<=y||$.inArray(r,n.limitData.include_way_ids)>-1)m=b;return v=e.util.formatMoney(Math.min(v,m),2),$("#J-method-prize i").text(v)},setAmountDom:function(e){var t=this;t.getAmountDom().html(e)},reSet:function(){var e=this,t=e.defConfig,n=($(t.multipleDomFixed).is(":checked")?!0:!1)||!1;console.log(n),n||e.multipleDom.setValue(1)}},a=e.Class(u,n);a.defConfig=i,a.getInstance=function(e){return s||(s=new a(e))},e[t]=a})(caipiaogame,"GameStatistics",caipiaogame.Event)